# Feedback App

## üìù –û–ø–∏—Å
–¶–µ —Å—É—á–∞—Å–Ω–∏–π –≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è –∑–±–æ—Ä—É, –ø–µ—Ä–µ–≥–ª—è–¥—É —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –≤—ñ–¥–≥—É–∫—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –Ω–∞ Flask (Python), –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è ‚Äî PostgreSQL, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî HTML/CSS/JS, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è ‚Äî Docker, –≤–µ–±-—Å–µ—Ä–≤–µ—Ä ‚Äî Nginx. –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ Jenkins CI/CD, –∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Prometheus —Ç–∞ Grafana. –î–æ–¥–∞—Ç–æ–∫ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–ª–±–µ–∫, –≥–Ω—É—á–∫–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤–µ—Ä—Å—ñ—è–º–∏, –ø–æ–≤–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –ø—Ä–æ—Å—Ç–µ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É
```
feedback-app/
‚îú‚îÄ‚îÄ app/                    # –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–¥ Flask-–¥–æ–¥–∞—Ç–∫—É
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py         # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Flask
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # –ú–æ–¥–µ–ª—ñ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ routes.py           # –ú–∞—Ä—à—Ä—É—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ forms.py            # –§–æ—Ä–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ static/             # CSS, JS
‚îÇ   ‚îî‚îÄ‚îÄ templates/          # HTML-—à–∞–±–ª–æ–Ω–∏
‚îú‚îÄ‚îÄ nginx/                  # Nginx-–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ monitoring/             # Prometheus, Grafana, Node Exporter
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose (—Ä–æ–∑—Ä–æ–±–∫–∞)
‚îú‚îÄ‚îÄ docker-compose.prod.yml # Docker Compose (–ø—Ä–æ–¥–∞–∫—à–Ω)
‚îú‚îÄ‚îÄ Dockerfile              # Dockerfile –¥–ª—è Flask
‚îú‚îÄ‚îÄ Jenkinsfile             # Jenkins pipeline (CI/CD)
‚îú‚îÄ‚îÄ requirements.txt        # Python-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ run.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É Flask
‚îú‚îÄ‚îÄ init_db.py              # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ë–î
‚îî‚îÄ‚îÄ create_admin_user.py    # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

---

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ —Å–µ—Ä–≤—ñ—Å–∏
- **Flask** ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π –≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫ (API, –ª–æ–≥—ñ–∫–∞, –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è, –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å)
- **PostgreSQL** ‚Äî –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- **Nginx** ‚Äî —Ä–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å—ñ, HTTPS, —Å—Ç–∞—Ç–∏–∫–∞
- **Prometheus** ‚Äî –∑–±—ñ—Ä –º–µ—Ç—Ä–∏–∫ (Flask, Node Exporter)
- **Grafana** ‚Äî –¥–∞—à–±–æ—Ä–¥–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
- **Node Exporter** ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ EC2
- **Docker Compose** ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤

---

## üöÄ CI/CD —Ç–∞ –¥–µ–ø–ª–æ–π (Jenkins)
### –û—Å–Ω–æ–≤–Ω—ñ –µ—Ç–∞–ø–∏ –ø–∞–π–ø–ª–∞–π–Ω—É
1. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤** (EC2, DockerHub, —Å–µ–∫—Ä–µ—Ç–∏)
2. **–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–¥—É** (–∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞)
3. **–û—á–∏—â–µ–Ω–Ω—è EC2** (FORCE_CLEANUP ‚Äî –ø–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è Docker-—Ä–µ—Å—É—Ä—Å—ñ–≤)
4. **–ü–µ—Ä–µ–¥–∞—á–∞ –∞—Ä—Ö—ñ–≤—É –Ω–∞ EC2**
5. **–†–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è .env** (—Å–µ–∫—Ä–µ—Ç–∏, –∑–º—ñ–Ω–Ω—ñ)
6. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–±—Ä–∞–∑—É –∑ DockerHub** (–∞–±–æ –∑–±—ñ—Ä–∫–∞, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
7. **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose.prod.yml**
8. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É, –ø–æ—Ä—Ç—ñ–≤, –ª–æ–≥—ñ–≤**
9. **–ü—É—à –æ–±—Ä–∞–∑—É –≤ DockerHub** (—è–∫—â–æ –Ω–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ)
10. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É**

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ Jenkins pipeline
- `EC2_IP` ‚Äî IP-–∞–¥—Ä–µ—Å–∞ EC2
- `EC2_USER` ‚Äî –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á EC2
- `FORCE_REBUILD` ‚Äî –ø—Ä–∏–º—É—Å–æ–≤–µ –ø–µ—Ä–µ–±—É–¥—É–≤–∞–Ω–Ω—è –æ–±—Ä–∞–∑—É
- `FORCE_CLEANUP` ‚Äî –ø–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è Docker –Ω–∞ EC2
- `FORCE_ROLLBACK` ‚Äî –≤—ñ–¥–∫–∞—Ç –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó
- `ROLLBACK_TAG` ‚Äî —Ç–µ–≥ DockerHub –¥–ª—è —Ä–æ–ª–±–µ–∫—É (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º latest)
- `SKIP_DOCKERHUB` ‚Äî –Ω–µ –ø—É—à–∏—Ç–∏ –æ–±—Ä–∞–∑ —É DockerHub

### Rollback
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π** ‚Äî –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –¥–µ–ø–ª–æ—é, EC2 –∑–∞–≤–∂–¥–∏ –ø—ñ–¥–Ω—ñ–º–∞—î—Ç—å—Å—è –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑—É –∑ DockerHub
- **–†—É—á–Ω–∏–π** ‚Äî –∞–∫—Ç–∏–≤—É–π—Ç–µ `FORCE_ROLLBACK`, –≤–∫–∞–∂—ñ—Ç—å `ROLLBACK_TAG` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ), –∑–∞–ø—É—Å—Ç—ñ—Ç—å –ø–∞–π–ø–ª–∞–π–Ω
- **–ü—ñ—Å–ª—è rollback** ‚Äî –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç—å, .env –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è, –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∞—Ü—é—î

---

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Å–µ–∫—Ä–µ—Ç–∏
- `SECRET_KEY` ‚Äî Flask-—Å–µ–∫—Ä–µ—Ç
- `POSTGRES_PASSWORD` ‚Äî –ø–∞—Ä–æ–ª—å –¥–æ PostgreSQL
- `ADMIN_PASSWORD` ‚Äî –ø–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –í—Å—ñ —Å–µ–∫—Ä–µ—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É Jenkins Credentials —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–∏—à—É—Ç—å—Å—è —É .env –Ω–∞ EC2

---

## üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞
- HTTPS (Nginx)
- –ó–∞—Ö–∏—â–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (Jenkins)
- –ü–∞—Ä–æ–ª—ñ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ CSRF
- –î–æ—Å—Ç—É–ø –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ –ª–∏—à–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö

---

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –¥–∞—à–±–æ—Ä–¥–∏
- **Prometheus**: –∑–±—ñ—Ä –º–µ—Ç—Ä–∏–∫ –∑ Flask (`/metrics`) —Ç–∞ Node Exporter
- **Grafana**: –∞–≤—Ç–æ–æ–Ω–æ–≤–ª—é–≤–∞–Ω—ñ –¥–∞—à–±–æ—Ä–¥–∏ (CPU, RAM, –¥–∏—Å–∫, –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≥—É–∫—ñ–≤)
- **Healthcheck**: `/health` (Flask), —Å—Ç–∞—Ç—É—Å–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤, –ø–æ—Ä—Ç–∏
- **–î–∞—à–±–æ—Ä–¥–∏**: `monitoring/grafana/provisioning/dashboards/`
- **–î–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö**: `monitoring/grafana/provisioning/datasources/`
- **–ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è**: –∫–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ω–∞ EC2
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
cd /home/<EC2_USER>/feedback-app-deploy
docker-compose -f docker-compose.prod.yml ps

# –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
docker-compose -f docker-compose.prod.yml logs

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose -f docker-compose.prod.yml restart

# –ó—É–ø–∏–Ω–∫–∞
docker-compose -f docker-compose.prod.yml down

# –û—á–∏—â–µ–Ω–Ω—è Docker
sudo docker system prune -f
```

---

## üßë‚Äçüíª –†—É—á–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è (dev/test)
1. –ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
2. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
```bash
python -m venv .venv
.venv\Scripts\activate     # Windows
pip install -r requirements.txt
```
3. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–π—Ç–µ –ë–î —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
```bash
python init_db.py
python create_admin_user.py
```
4. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —á–µ—Ä–µ–∑ Docker:
```bash
docker-compose -f docker-compose.prod.yml up -d
```

---

## üß© –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ —Ç–∞ –º–µ—Ä–µ–∂–∞
```mermaid
graph TD
    Nginx --> Flask
    Flask --> PostgreSQL
    Prometheus --> NodeExporter
    Prometheus --> Grafana
```
- –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ —É –≤–ª–∞—Å–Ω—ñ–π –º–µ—Ä–µ–∂—ñ Docker
- Nginx –≤—ñ–¥–∫—Ä–∏–≤–∞—î –ª–∏—à–µ 80/443, —ñ–Ω—à—ñ –ø–æ—Ä—Ç–∏ ‚Äî –ª–∏—à–µ –¥–ª—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó

---

## üì¶ DockerHub
- –ü—É—à–∏—Ç—å—Å—è –ª–∏—à–µ Flask-–æ–±—Ä–∞–∑ (`justendray/feedback_app:<tag>`)
- EC2 –∑–∞–≤–∂–¥–∏ —Ç—è–≥–Ω–µ –æ–±—Ä–∞–∑ –∑ DockerHub (–¥–µ–ø–ª–æ–π —ñ rollback)
- –¢–µ–≥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –Ω–æ–º–µ—Ä—É –∑–±—ñ—Ä–∫–∏ Jenkins

---

## üìù –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
- **–ì–æ–ª–æ–≤–Ω–∏–π —Å–∞–π—Ç**: http://<EC2_IP>
- **–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å**: http://<EC2_IP>/feedback_page
- **Healthcheck**: http://<EC2_IP>/health
- **Prometheus**: http://<EC2_IP>:9090
- **Grafana**: http://<EC2_IP>:3000

---

## üë§ –ê–≤—Ç–æ—Ä
Andrew Pastushuk